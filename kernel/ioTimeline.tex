\usetikzlibrary{patterns}
\begin{frame}\frametitle{context switches and exceptions}
\begin{tikzpicture}
\tikzset{%
    prog1/.style={draw,fill=cyan},
    prog2/.style={draw,fill=green},
    prog3/.style={draw,fill=violet!30},
    proglabel/.style={font=\tt\scriptsize},
    labelprog1/.style={execute at begin node={\strut loop.exe}},
    labelprog2/.style={execute at begin node={\strut ssh.exe}},
    labelprog3/.style={execute at begin node={\strut firefox.exe}},
    switchlabel/.style={font=\scriptsize},
}
\begin{scope}[xscale=2,yscale=1]
\foreach \s/\e/\p/\lbl [count=\x] in {0/2/1/timer,2/3/2/net,3/5/3/syscall,5/6/1/timer,6/7/2/syscall}{
    \coordinate (s-\x) at (\s, 0);
    \coordinate (e-\x) at (\e, 0);
    \draw[prog\p] (\s, 0) rectangle (\e, 1) coordinate[midway] (mid-\x);
    \node[anchor=center,proglabel,labelprog\p] at (mid-\x) {};
    \begin{pgfonlayer}{fg}
    \draw[fill=white] ([xshift=-.05cm]e-\x) rectangle ([xshift=.05cm,yshift=1cm]e-\x);
    \draw[pattern=north west lines] ([xshift=-.05cm]e-\x) rectangle ([xshift=.05cm,yshift=1cm]e-\x);
    \node[switchlabel,anchor=north] at (e-\x.south) {\lbl};
   \end{pgfonlayer}
}
\foreach \p/\lbl [count=\x] in {0.3/net,0.7/key,1.3/key,2.4/net,3.5/syscall,4.2/key,5.6/key,6.5/key}{
    \coordinate (os-\x) at (\p, 0);
    \draw[fill=white] ([xshift=-.05cm]os-\x) rectangle ([xshift=.05cm,yshift=1cm]os-\x);
    \draw[pattern=north west lines] ([xshift=-.05cm]os-\x) rectangle ([xshift=.05cm,yshift=1cm]os-\x);
    \node[switchlabel,anchor=north] at (os-\x.south) {\lbl};
}
\end{scope}
\begin{scope}[xshift=5cm]
\draw[fill=white,pattern=north west lines] (0, -1) rectangle (1, -2);
\node[anchor=west] at (1, -1.5) {\strut = operating system};
\end{scope}
\end{tikzpicture}
\begin{itemize}
\item program execution interleaves with OS
\item OS might handle with context switch, might not
\end{itemize}
\end{frame}

