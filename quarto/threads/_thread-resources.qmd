
### thread joining  {.smaller}


* pthread_join allows collecting thread return value
* if you don't join joinable thread, then <em>memory leak</em>! 
<hr class="vspace" />
* avoiding memory leak?
* always join… or
* ‘‘detach’’ thread to make it not joinable


### pthread_detach  


```{.c code-line-numbers="|8"}
void *show_progress(void * ...) { ... }
void spawn_show_progress_thread() {
    pthread_t show_progress_thread;
    pthread_create(&show_progress_thread, NULL,
                   show_progress, NULL);

    /* instead of keeping pthread_t around to join thread later: */
    pthread_detach(show_progress_thread);]
}

int main() {
    spawn_show_progress_thread();
    do_other_stuff();
    ...
}
```

::: {.myoverbox .vlow }

detach = don't care about return value, etc. <br />
system will decallocate when thread terminates

:::

### starting threads detached

```{.c code-line-numbers="|6"}
void *show_progress(void * ...) { ... }
void spawn_show_progress_thread() {
    pthread_t show_progress_thread;
    pthread_attr_t attrs;
    pthread_attr_init(&attrs);
    pthread_attr_setdetachstate(&attrs, PTHREAD_CREATE_DETACHED);
    pthread_create(&show_progress_thread, attrs,
                   show_progress, NULL);
    pthread_attr_destroy(&attrs);
}
```


### setting stack sizes 

```{.c code-line-numbers="6"}
void *show_progress(void * ...) { ... }
void spawn_show_progress_thread() {
    pthread_t show_progress_thread;
    pthread_attr_t attrs;
    pthread_attr_init(&attrs);
    pthread_attr_setstacksize(&attrs, 32 * 1024 /* bytes */);
    pthread_create(&show_progress_thread, attrs,
                   show_progress, NULL);
}
```
