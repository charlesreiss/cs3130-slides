
### xv6 interrupt disabling: detail (3)  {.smaller}


<pre><code>pushcli(void)
{
  int eflags;
  eflags = readeflags();
  <span data-fragment-index="5" class="fragment custom myem-only">cli();</span>
  if (<span data-fragment-index="2" class="fragment custom myem-only">mycpu()</span>-&gt;ncli == 0)
    <span data-fragment-index="2" class="fragment custom myem-only">mycpu()</span>-&gt;<span data-fragment-index="3" class="fragment custom myem-only">intena = eflags &amp; FL_IF</span>;
  <span data-fragment-index="4" class="fragment custom myem-only">@2mycpu()2@-&gt;ncli += 1;</span>
}

popcli(void)
{
  if(readeflags()&amp;FL_IF)
    panic("popcli - interruptible");
  if(<span data-fragment-index="4" class="fragment custom myem-only">--@2mycpu()2@-&gt;ncli</span> &lt; 0)
    panic("popcli");
  <span data-fragment-index="6" class="fragment custom myem-only">if(@2mycpu()2@-&gt;ncli == 0 &amp;&amp; @2mycpu()2@-&gt;@3intena3@)</span>
    <span data-fragment-index="6" class="fragment custom myem-only">sti();</span>
}
</code></pre>
 ![](/sync-lock-impl/texfig/xv6-pushpopcli-detail.figure-1.svg){.absolute top="0%" left="0%" width=1050 height=600 .my-center  .fragment .fade-in-then-out fragment-index=1}
![](/sync-lock-impl/texfig/xv6-pushpopcli-detail.figure-2.svg){.absolute top="0%" left="0%" width=1050 height=600 .my-center  .fragment .fade-in-then-out fragment-index=2}
![](/sync-lock-impl/texfig/xv6-pushpopcli-detail.figure-3.svg){.absolute top="0%" left="0%" width=1050 height=600 .my-center  .fragment .fade-in-then-out fragment-index=3}
![](/sync-lock-impl/texfig/xv6-pushpopcli-detail.figure-4.svg){.absolute top="0%" left="0%" width=1050 height=600 .my-center  .fragment .fade-in-then-out fragment-index=4}
![](/sync-lock-impl/texfig/xv6-pushpopcli-detail.figure-5.svg){.absolute top="0%" left="0%" width=1050 height=600 .my-center  .fragment .fade-in-then-out fragment-index=5}
![](/sync-lock-impl/texfig/xv6-pushpopcli-detail.figure-6.svg){.absolute top="0%" left="0%" width=1050 height=600 .my-center  .fragment .fade-in-then-out fragment-index=6}

