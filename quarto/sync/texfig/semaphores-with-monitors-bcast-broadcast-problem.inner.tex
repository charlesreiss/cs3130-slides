\begin{tikzpicture}
\tikzset{
    >=Latex,
    timeline/.style={
        tight matrix,fill=white,
        nodes={text width=3.5cm,font=\fontsize{9.5}{10.5}\selectfont,fill=white,text depth=0.075cm,text height=0.25cm},
        anchor=north east,
        row 1/.style={nodes={font=\bfseries\fontsize{9.5}{10.5}\selectfont,draw=none,align=center}},
    },
}
\matrix[timeline] (tl) {
    Thread 1 \& Thread 2 \& Thread 3 \& Thread 4 \\
    Down() \\
    lock   \\
    count == 0? yes \\
    unlock/wait \\
         \& Down() \& \\
         \& lock \& \\
         \& count == 0? yes \& \\
         \& unlock/wait \\
         \& \& Up() \\
         \& \& lock \\
         \& \& count += 1 (now 1) \& Up()\\
    |[alias=waitCvDone]| stop waiting on CV \& \& |[alias=signalDone]| signal \& wait for lock\\
    |[alt=<3>{fill=red!15}]| wait for lock \& \& unlock \& wait for lock \\
    |[alt=<3>{fill=red!15}]| wait for lock \& \& \& |[alt=<3>{fill=blue!15},alias=actualLock]| lock \\
    |[alt=<3>{fill=red!15}]| wait for lock \& \& \& count += 1 (now 2) \\
    |[alt=<3>{fill=red!15}]| wait for lock \& \& \& count != 1: don't signal \\
    lock \& \& \& unlock \\
    count == 0? no \\
    count -= 1 (becomes 1) \\
    unlock \\
    \& |[alt=<2>{fill=red!15}]| still waiting??? \\
};
\begin{visibleenv}<3>
    \draw[red,very thick,->] (signalDone.west) -- (waitCvDone.east)
        node[midway, below,align=center,font=\small] {
            Mesa-style monitors \\
            signalling doesn't \\
            ``hand off'' lock
        };
\end{visibleenv}
\end{tikzpicture}