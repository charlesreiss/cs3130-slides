\begin{tikzpicture}
\tikzset{
    mylabel/.style={font=\ttfamily},
    mybox/.style={draw,rectangle,minimum width=7cm,fill=white,inner sep=1mm},
    myhigh/.style={draw,rectangle,line width=1mm, draw=blue!80!black,opacity=.3},
}
\begin{scope}[name prefix=A-]
\node[mybox,minimum height=1cm,pattern=north west lines,pattern color=black!5!white] (kernel) {Used by OS};
\node[above=0cm of kernel] {Program Memory};
\node[mybox, minimum height=.5cm, below=1cm of kernel] (stack) {Stack};
\node[mybox, minimum height=.5cm, below=1cm of stack] (heap) {Heap / other dynamic};
\node[mybox, minimum height=.5cm, below=0mm of heap] (data) {Writable data};
\node[mybox, minimum height=.5cm, below=0mm of data] (sdata) {Code + Constants};
\coordinate (memBottom) at ($(sdata.south east) + (0mm, -2mm)$);
\begin{pgfonlayer}{bg}
\draw[pattern=north west lines, pattern color=black!40!white] (kernel.north west) rectangle (memBottom);
\end{pgfonlayer}
\node[draw,very thick,blue,inner sep=0mm,fit=(stack)] {};
\end{scope}
\coordinate (zoomBase) at ([xshift=1cm]A-kernel.north east);
\begin{scope}[shift=(zoomBase)]
\draw[ultra thick,blue] (0, 0) rectangle (6, -8);
\foreach \x in {-1,-2,-3,-4,-5,-6,-7} {
    \draw (0, \x) -- (6, \x);
}
\draw (A-stack.north east) -- (0, 0);
\draw (A-stack.south east) -- (0, -8);
\begin{visibleenv}<2->
    \draw[fill=green, fill opacity=0.1, ultra thick] (0, 0) rectangle (6, -3);
    \node[green!60!black] at (3, -1.5) { used stack space (12 KB) };
    \draw[fill=blue, fill opacity=0.1, ultra thick] (0, -3) rectangle (6, -8);
    \node[blue!60!black] at (3, -4.5) { wasted space? (huge??) };
\end{visibleenv}
\begin{visibleenv}<3->
    \node[draw=red,ultra thick,fill=white] at (-1, -3.5) {
        OS would like to allocate space only if needed
    };
\end{visibleenv}
\end{scope}
\end{tikzpicture}