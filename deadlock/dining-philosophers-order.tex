\usetikzlibrary{shapes.misc}

\begin{frame}{dining philosophers --- ordering}
\begin{tikzpicture}
% FIXME: dining philosophers
\path[draw,ultra thick] (0, 0) circle (3cm);
\foreach \x in {0,144} {
    \begin{visibleenv}<1->
    \path[fill=blue!20] (\x:2.5cm) circle (.5cm);
    \end{visibleenv}
}
\foreach \x in {0,72,144,216,288} {
    \begin{visibleenv}<1>
    \path[fill=black!75,draw,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \end{visibleenv}
    \draw[rounded corners,thick] (\x+27:3.9cm) -- (\x+45:3.9cm) -- (\x+46:3.3cm) -- (\x+26:3.3cm) -- cycle;
    \draw[fill=white,very thick] (\x+36:3.6cm) circle (0.4cm);
    \draw[thick] (\x+36:2.5cm) circle (0.4cm);
    \draw[thin] (\x+36:2.5cm) circle (0.35cm);
}
\foreach \x in {} {
    \begin{visibleenv}<2>
    \path[fill=black!75,draw,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \end{visibleenv}
    \begin{visibleenv}<3>
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x+26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x+26.5:2.3cm);
    \end{visibleenv}
    \begin{visibleenv}<3-4>
    \path[fill=red!75,draw=red!75!black,thick] (\x+26.5:3.2cm) -- (\x+26:3.2cm) -- (\x+26:2.3cm) -- cycle;
    \end{visibleenv}
}
\foreach \x in {72,288} {
    \begin{visibleenv}<2>
    \path[fill=black!75,draw,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \end{visibleenv}
    \begin{visibleenv}<3>
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x-26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x-26.5:2.3cm);
    \end{visibleenv}
    \begin{visibleenv}<3-4>
    \path[fill=red!75,draw=red!75!black,thick] (\x-26.5:3.2cm) -- (\x-26:3.2cm) -- (\x-26:2.3cm) -- cycle;
    \end{visibleenv}
}
\foreach \x in {0,144} {
    \begin{visibleenv}<2>
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x+26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x+26.5:2.3cm);
    \draw[dashed] (\x:2.9cm) -- (\x-26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x-26.5:2.3cm);
    \end{visibleenv}
    \begin{visibleenv}<2-4>
    \path[fill=red!75,draw=red!75!black,thick] (\x+26.5:3.2cm) -- (\x+26:3.2cm) -- (\x+26:2.3cm) -- cycle;
    \end{visibleenv}
}
\foreach \x in {216} {
    \begin{visibleenv}<1>
    \path[fill=black!75,draw,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \end{visibleenv}
    \begin{visibleenv}<2>
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x+26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x+26.5:2.3cm);
    \end{visibleenv}
    \begin{visibleenv}<2-4>
    \path[fill=red!75,draw=red!75!black,thick] (\x+26.5:3.2cm) -- (\x+26:3.2cm) -- (\x+26:2.3cm) -- cycle;
    \end{visibleenv}
    %\begin{visibleenv}<3-4>
    %\draw[dashed,very thick,fill=red!10] (\x+52:2.8cm) circle (0.4cm);
    %\end{visibleenv}
    \draw[rounded corners,thick] (\x+27:3.9cm) -- (\x+45:3.9cm) -- (\x+46:3.3cm) -- (\x+26:3.3cm) -- cycle;
    \draw[fill=white,very thick] (\x+36:3.6cm) circle (0.4cm);
    \draw[thick] (\x+36:2.5cm) circle (0.4cm);
    \draw[thin] (\x+36:2.5cm) circle (0.35cm);
}
\begin{visibleenv}<5->
\foreach \x in {72,288} {
    \path[draw=red!75,thick] (\x-36:2.5cm) node[draw,cross out] {};
}
\end{visibleenv}
\begin{visibleenv}<5->
\foreach \x in {0,72,216,288} {
    \path[fill=black!75,draw,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
}
\end{visibleenv}
\begin{visibleenv}<5-6>
\foreach \x in {144} {
    \path[fill=red!75,draw=red!75!black,thick] (\x+26.5:3.2cm) -- (\x+26:3.2cm) -- (\x+26:2.3cm) -- cycle;
}
\end{visibleenv}
\begin{visibleenv}<6>
\foreach \x in {0,216} {
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x-26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x-26.5:2.3cm);
    \path[fill=red!75,draw=red!75!black,thick] (\x-26.5:3.2cm) -- (\x-26:3.2cm) -- (\x-26:2.3cm) -- cycle;
}
\foreach \x in {288} {
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x+26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x+26.5:2.3cm);
    \path[fill=red!75,draw=red!75!black,thick] (\x+26.5:3.2cm) -- (\x+26:3.2cm) -- (\x+26:2.3cm) -- cycle;
}
\end{visibleenv}
\begin{visibleenv}<7->
\foreach \x in {216,0} {
    \path[draw=red!75,thick] (\x-36:2.5cm) node[draw,cross out] {};
}
\foreach \x in {144} {
    \path[fill=black!75,draw,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
}
\end{visibleenv}
\begin{visibleenv}<8>
\foreach \x in {144} {
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x-26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x-26.5:2.3cm);
    \path[fill=red!75,draw=red!75!black,thick] (\x-26.5:3.2cm) -- (\x-26:3.2cm) -- (\x-26:2.3cm) -- cycle;
}
\foreach \x in {72} {
    \path[fill=black!25,draw=black!25,thick] (\x:1.8cm) -- (\x+0.5:2.9cm) -- (\x-0.5:2.9cm) -- cycle;
    \draw[dashed] (\x:2.9cm) -- (\x+26.5:3.2cm);
    \draw[dashed] (\x:1.8cm) -- (\x+26.5:2.3cm);
    \path[fill=red!75,draw=red!75!black,thick] (\x+26.5:3.2cm) -- (\x+26:3.2cm) -- (\x+26:2.3cm) -- cycle;
}
\end{visibleenv}
\begin{visibleenv}<1-3>
\node[anchor=west,align=left] at (4.0, 0) {
    mark some chopsticks places \\
    rule: grab from marked place first \\
    only grab other chopstick after that 
};
\end{visibleenv}
\begin{visibleenv}<4->
\node[anchor=west,align=left] at (4.0, 0) {
    mark some chopsticks places \\
    rule: grab from marked place first \\
    only grab other chopstick after that  \\
    ~ \\
    avoids circular dependency, \\
    means everyone else \\
    \myemph{eventually} gets a turn
};
\end{visibleenv}
\end{tikzpicture}
\end{frame}
