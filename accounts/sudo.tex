\begin{frame}[fragile,label=sudoEx]{sudo}
\begin{lstlisting}[
    language={},
    moredelim={**[is][\it]{X}{X}},
    moredelim={**[is][\color{red}]{Y}{Y}},
]
tj1a@somemachine$ Ysudo restartY
Password: *********
\end{lstlisting}
\begin{itemize}
\item sudo: run command with superuser permissions
    \begin{itemize}
    \item started by non-superuser
    \end{itemize}
\item recall: inherits non-superuser UID
\item can't just call \texttt{setuid(0)}
\end{itemize}
\end{frame}

\begin{frame}{set-user-ID sudo}
\begin{itemize}
\item extra metadata bit on \textit{executables}: set-user-ID
\item if set: \texttt{exec()} syscall changes effective user ID to owner's ID
\item \texttt{sudo} program: owned by root, marked set-user-ID
\vspace{.5cm}
\item marking setuid: \texttt{chmod u+s}
\end{itemize}
\end{frame}

\begin{frame}{set-user ID gates}
\begin{itemize}
\item set-user ID program: gate to higher privilege
\vspace{.5cm}
\item controlled access to extra functionality
\item make authorization/authentication decisions \textit{outside the kernel}
\item way to allow normal users to do \textit{one thing that needs privileges}
    \begin{itemize}
    \item write program that does that one thing --- nothing else!
    \item make it owned by user that can do it (e.g. root)
    \item mark it set-user-ID
    \end{itemize}
\item want to allow only some user to do the thing
    \begin{itemize}
    \item make program check which user ran it
    \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{uses for setuid programs}
\begin{itemize}
    \item mount USB stick
        \begin{itemize}
        \item setuid program controls option to kernel mount syscall
        \item make sure user can't replace sensitive directories
        \item make sure user can't mess up filesystems on normal hard disks
        \item make sure user can't mount new setuid root files
        \end{itemize}
    \item control access to device --- printer, monitor, etc.
        \begin{itemize}
        \item setuid program talks to device + decides who can
        \end{itemize}
    \item write to secure log file
        \begin{itemize}
        \item setuid program ensures that log is append-only for normal users
        \end{itemize}
    \item bind to a particular port number $<$ 1024
        \begin{itemize}
        \item setuid program creates socket, then becomes not root
        \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{set-user-ID program v syscalls}
\begin{itemize}
\item hardware decision: some things only for kernel
\item system calls: \textit{controlled} access to things kernel can do
\item decision about how can do it: in the kernel
\vspace{.5cm}
\item kernel decision: some things only for root (or other user)
\item set-user-ID programs: controlled access to things root/\ldots{} can do
\item decision about how can do it: made by root/\ldots
\end{itemize}
\end{frame}

